<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Elmesp dashboard</title>
</head>
<body>
    <script src='https://d3js.org/d3.v4.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <h3>Dashboard</h3>
    <svg id="svg1" width='800' height='400'></svg>

    <script>
        const EVENT_TYPE_NAMES = [
            'TIME_INITIALIZATION',
            'TIME_REGISTER',
            'FUEL_LEVEL',
            'SUDDEN_ACCELERATION',
            'SUDDEN_BRAKE',
            'TOP_SPEED'
        ];
    </script>

    

    <!--script>
        const data = [80, 120, 60, 150, 200];
        const barHeight = 20;
        const bar = d3.select('svg')
            .selectAll('rect')
            .data(data)
            .enter()
            .append('rect')
            .attr('width', function(d) {  return d; })
            .attr('height', barHeight - 1)
            .attr('transform', function(d, i) {
                return "translate(0," + i * barHeight + ")";
            });
    </script-->

    <script>
        const width = 800;
        const height = 400;
        const margin = {top: 50, bottom: 50, left: 50, right: 50};

        axios.get('/api/reports').then((response) => {
            const data = response.data;
            console.log(data);

            // Draw a chart
            const x = d3.scaleBand()
                .domain(d3.range(data.length))
                .range([margin.left, width - margin.right])
                .padding(0.4);

            const y = d3.scaleLinear()
                .domain([0, 150])
                .range([height - margin.bottom, margin.top]);

            function xAxis(g){
                g.attr('transform', `translate(0, ${height - margin.bottom})`)
                .call(d3.axisBottom(x).tickFormat(i => EVENT_TYPE_NAMES[(data[i]._id - 1)]));
            }

            function yAxis(g){
                g.attr('transform', `translate(${margin.left}, 0)`)
                .call(d3.axisLeft(y).ticks(null, data.format));
            }

            d3.select('#svg1')
                .append('g')
                .attr('fill', 'royalBlue')
                .selectAll('rect')
                .data(data.sort((a, b) => a._id - b._id))
                .enter()
                .append('rect')
                    .attr('x', (_data, index) => x(index))
                    .attr('y', (data) => y(data.count))
                    .attr('height', data => y(0) - y(data.count))
                    .attr('width', x.bandwidth());

            d3.select('#svg1').append('g').call(yAxis)
            d3.select('#svg1').append('g').call(xAxis);
        });

    </script>
    
    <svg id="svg2" width='800' height='400'></svg>

    <script>
        axios.get('/api/reports').then((response) => {
            const data = response.data;
            console.log(data);

            const dataset1 = [
                [1,1], [20,20], [24,36],
                [32, 50], [40, 70], [50, 100],
                [55, 106], [65, 123], [73, 130],
                [78, 134], [83, 136], [89, 138],
                [100, 140]
            ];

            // Draw a chart
            const svg2 = d3.select("#svg2"),
                margin = 50,
                width = svg2.attr("width") - margin,
                height = svg2.attr("height") - margin;

            const xScale = d3.scaleLinear().domain([0, 100]).range([0, width]);
            const yScale = d3.scaleLinear().domain([0, 200]).range([height, 0]);

            const g = svg2.append("g")
                .attr("transform", "translate(" + 60 + "," + 20 + ")");

            // Title
            svg2.append('text')
                .attr('x', width/2 + 100)
                .attr('y', 20)
                .attr('text-anchor', 'middle')
                .style('font-family', 'Helvetica')
                .style('font-size', 20)
                .text('History');

            // X label
            svg2.append('text')
                .attr('x', width/2 + 100)
                .attr('y', height + margin)
                .attr('text-anchor', 'middle')
                .style('font-family', 'Helvetica')
                .style('font-size', 12)
                .text('Timestamp');

            // Y label
            svg2.append('text')
                .attr('text-anchor', 'middle')
                .attr('transform', 'translate(20,' + height/2 + ')rotate(-90)')
                .style('font-family', 'Helvetica')
                .style('font-size', 12)
                .text('Event type');

            // Step 6
            g.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(xScale));
            
            g.append("g")
                .call(d3.axisLeft(yScale));

            // Step 7
            svg2.append('g')
                .selectAll("dot")
                .data(dataset1)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return xScale(d[0]); } )
                .attr("cy", function (d) { return yScale(d[1]); } )
                .attr("r", 3)
                .attr("transform", "translate(" + margin + "," + "0)")
                .style("fill", "#CC0000");

        });

    </script>
</body>
</html>